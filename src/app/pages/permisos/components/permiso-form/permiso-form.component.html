<div class="mx-auto p-4">
  <p-toast></p-toast>
  <p-toast />

  <!-- Confirm dialog con estilo sobrio -->
  <p-confirmDialog #cd [style]="{ width: '90vw', maxWidth: '450px' }">
    <ng-template #headless let-message let-onAccept="onAccept" let-onReject="onReject">
      <div class="flex flex-col items-center p-8 bg-white dark:bg-gray-900 rounded-2xl shadow-xl">
        <!-- Icono -->
        <div
          class="rounded-full bg-primary/10 text-primary inline-flex justify-center items-center h-20 w-20 -mt-16 shadow-md">
          <i class="pi pi-question !text-4xl"></i>
        </div>

        <!-- Header -->
        <span class="font-semibold text-xl block mb-2 mt-6 text-gray-800 dark:text-gray-100">
          {{ message.header }}
        </span>

        <!-- Mensaje -->
        <p class="text-center text-gray-600 dark:text-gray-400 text-sm mb-0">
          {{ message.message }}
        </p>

        <!-- Botones -->
        <div class="flex items-center gap-3 mt-8">
          <p-button label="Confirmar" (onClick)="onAccept()"
            styleClass="w-32 p-button-primary rounded-xl shadow-sm"></p-button>
          <p-button label="Cancelar" [outlined]="true" (onClick)="onReject()"
            styleClass="w-32 p-button-secondary rounded-xl"></p-button>
        </div>
      </div>
    </ng-template>
  </p-confirmDialog>
  <!-- Botón flotante (solo móvil) -->
  <div class="md:hidden fixed bottom-6 right-6 z-50">
    <button pButton icon="pi pi-info-circle" class="p-button-rounded p-button-primary shadow-lg w-12 h-12"
      (click)="mostrarInfoContacto = !mostrarInfoContacto" [ngClass]="{'p-button-secondary': mostrarInfoContacto}">
    </button>
  </div>

  <!-- Panel de contacto móvil -->
  <div
    class="md:hidden fixed inset-x-0 bottom-0 bg-gray-50 dark:bg-gray-800 rounded-t-2xl shadow-xl transform transition-transform duration-300 z-40"
    [class]="mostrarInfoContacto ? 'translate-y-0' : 'translate-y-full'">
    <div class="p-4">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-bold text-primary dark:text-primary-300">Información de Contacto</h3>
        <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" (click)="mostrarInfoContacto = false">
          <i class="pi pi-times"></i>
        </button>
      </div>

      <div class="space-y-3 text-sm">
        <div class="flex items-center gap-3 text-gray-700 dark:text-gray-300">
          <i class="pi pi-user text-primary"></i>
          <div>
            <p class="font-medium">Nombre</p>
            <p class="text-gray-600 dark:text-gray-400">{{ form.get('nombre_colaborador')?.value || '-' }}</p>
          </div>
        </div>
        <div class="flex items-center gap-3 text-gray-700 dark:text-gray-300">
          <i class="pi pi-building text-primary"></i>
          <div>
            <p class="font-medium">Departamento</p>
            <p class="text-gray-600 dark:text-gray-400">{{ form.get('departamento')?.value || '-' }}</p>
          </div>
        </div>
        <div class="flex items-center gap-3 text-gray-700 dark:text-gray-300">
          <i class="pi pi-envelope text-primary"></i>
          <div>
            <p class="font-medium">Correo</p>
            <p class="text-gray-600 dark:text-gray-400">{{ form.get('correo_electronico')?.value || '-' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <!-- Panel izquierdo desktop -->
    <div
      class="hidden md:block md:col-span-1 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 p-4 rounded-xl shadow-md space-y-4 sticky top-6 h-fit">
      <h3
        class="text-lg font-bold text-primary dark:text-primary-300 border-b border-gray-200 dark:border-gray-700 pb-2">
        Información de Contacto
      </h3>

      <div class="flex items-center gap-3 text-gray-700 dark:text-gray-300 text-sm">
        <i class="pi pi-user text-primary"></i>
        <div>
          <p class="font-medium">Nombre</p>
          <p class="text-gray-600 dark:text-gray-400">{{ form.get('nombre_colaborador')?.value || '-' }}</p>
        </div>
      </div>
      <div class="flex items-center gap-3 text-gray-700 dark:text-gray-300 text-sm">
        <i class="pi pi-building text-primary"></i>
        <div>
          <p class="font-medium">Departamento</p>
          <p class="text-gray-600 dark:text-gray-400">{{ form.get('departamento')?.value || '-' }}</p>
        </div>
      </div>
      <div class="flex items-center gap-3 text-gray-700 dark:text-gray-300 text-sm">
        <i class="pi pi-envelope text-primary"></i>
        <div>
          <p class="font-medium">Correo</p>
          <p class="text-gray-600 dark:text-gray-400">{{ form.get('correo_electronico')?.value || '-' }}</p>
        </div>
      </div>
    </div>

    <!-- Panel derecho formulario -->
    <div class="md:col-span-2 bg-white dark:bg-gray-900 p-4 md:p-6 rounded-xl shadow-md space-y-4">
      <div class="flex items-center gap-2 mb-2">
        <i class="pi pi-calendar-plus text-primary text-xl"></i>
        <h2 class="text-xl md:text-2xl font-bold text-primary dark:text-primary-300">Solicitud de Permiso</h2>
      </div>

      <form [formGroup]="form" (ngSubmit)="guardar()" class="space-y-4">

        <!-- Correo jefe -->
        <div class="w-full">
          <label class="block mb-1 font-medium text-sm text-gray-700 dark:text-gray-300">
            Correo electrónico del Jefe
          </label>
          <p-autocomplete [suggestions]="correosSugeridos" (completeMethod)="buscarCorreos($event)"
            formControlName="correo_jefe" [forceSelection]="false" [dropdown]="true" placeholder="Escribe o selecciona"
            [style]="{'width':'100%'}"
            [inputStyle]="{'width':'100%','padding':'0.75rem','border-radius':'8px'}"></p-autocomplete>
        </div>

        <!-- Fechas -->
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
            <i class="pi pi-calendar text-primary"></i> Fechas del Permiso
          </h3>
          <div class="flex flex-wrap gap-4 mb-3 text-sm">
            <label class="flex items-center gap-2">
              <p-radioButton name="tipoFecha" value="rango" [(ngModel)]="tipoFechaSeleccionado" inputId="rango"
                [ngModelOptions]="{standalone:true}"></p-radioButton>
              Rango
            </label>
            <label class="flex items-center gap-2">
              <p-radioButton name="tipoFecha" value="individual" [(ngModel)]="tipoFechaSeleccionado"
                inputId="individual" [ngModelOptions]="{standalone:true}"></p-radioButton>
              Días individuales
            </label>
          </div>

          <!-- Rango -->
          <div *ngIf="tipoFechaSeleccionado==='rango'"
            class="bg-white dark:bg-gray-700 p-3 rounded-lg border border-gray-200 dark:border-gray-600">
            <p-datepicker formControlName="rangoFechas" selectionMode="range" dateFormat="dd/mm/yy"
              [style]="{'width':'100%'}" [inputStyle]="{'width':'100%','padding':'0.75rem','border-radius':'8px'}"
              [showButtonBar]="true" [showIcon]="true"></p-datepicker>
          </div>

          <!-- Individuales -->
          <div *ngIf="tipoFechaSeleccionado==='individual'" class="space-y-2">
            <div
              class="bg-white dark:bg-gray-700 p-2 rounded-lg max-h-40 overflow-y-auto flex flex-wrap gap-2 border border-gray-200 dark:border-gray-600 text-xs">
              <p-chip *ngFor="let dia of form.get('diasIndividuales')?.value || []; let i=index"
                [label]="formatoDia(dia)" removable="true" (onRemove)="eliminarDia(i)" styleClass="bg-primary text-white">
              </p-chip>
              <p *ngIf="!(form.get('diasIndividuales')?.value?.length)" class="text-gray-400 text-xs p-1">No hay días
              </p>
            </div>
            <p-datepicker [(ngModel)]="nuevoDia" dateFormat="dd/mm/yy" [ngModelOptions]="{standalone:true}"
              (onSelect)="agregarDiaSeleccionado()" [style]="{'width':'100%'}"
              [inputStyle]="{'width':'100%','padding':'0.75rem','border-radius':'8px'}" [showButtonBar]="true"
              [showIcon]="true"></p-datepicker>
          </div>
        </div>

        <!-- Motivo -->
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <label class="block mb-1 font-medium text-sm text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-comment text-primary"></i> Motivo
          </label>
          <textarea formControlName="motivo_permiso" rows="3" placeholder="Escribe el motivo"
            class="w-full rounded-lg border border-gray-300 dark:border-gray-600 p-3 text-sm bg-white dark:bg-gray-700"></textarea>
        </div>

        <!-- Tipo permiso -->
        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
          <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
            <i class="pi pi-tag text-primary"></i> Tipo de Permiso
          </h3>
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-2 text-xs">
            <button *ngFor="let tipo of tiposPermiso" type="button" pButton [label]="tipo.label"
              [ngClass]="{ 'p-button-primary': form.get('tipo_permiso')?.value === tipo.value, 'p-button-outlined': form.get('tipo_permiso')?.value !== tipo.value }"
              (click)="form.get('tipo_permiso')?.setValue(tipo.value)" class="w-full"></button>
          </div>
        </div>

        <!-- Botones -->
        <div
          class="flex flex-col sm:flex-row justify-end gap-2 mt-3 border-t border-gray-200 dark:border-gray-700 pt-3">
          <button pButton type="button" label="Cancelar"
            class="p-button-outlined p-button-secondary w-full sm:w-auto"></button>
          <button pButton type="submit" label="Enviar" icon="pi pi-send" [disabled]="form.invalid"
            class="p-button-lg bg-gradient-to-r from-primary to-blue-600 border-none text-white w-full sm:w-auto"></button>
        </div>

      </form>
    </div>
  </div>
</div>